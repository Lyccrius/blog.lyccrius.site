---
layout: post
title: "《算法竞赛入门经典——习题与解答》1.1 编程技巧"
date:   2022-08-27 
author: 陈峰
categories: solution sfjs-rmjd-xtyjd
---

## 1.1.1 排序性能问题

相对于 C 语言内置的 qsort 函数，C++ 中提供的 sort 函数使用起来更加方便，不需要做指针类型转换。

sort 有两种用法：第一种是传入一个 functor 对象，另外一种是直接传入一个排序函数，而这两种用法语义上都是正确的，但是实际测试发现使用 functor 的版本比直接使用函数的版本快不少

```
using namespace std;
#define _for(i,a,b) for( int i=(a); i<(b)>=; ++i)
const int N = 10000000;
struct TS{
    int a, b, c;
};
inline bool cmp (const TS& t1, const TS& t2) {
    if(t1.a != t2.a) return t1.a < t2.a;
    if(t1.b != t2.b) return t1.b < t2.b;
    return t1.c < t2.c;
}

int cmp4qsort(const void * a, const void * b) {
    TS *t1 = (TS*)a, *t2 = (TS*)b;
    if(t1->a != t2->a) return t1->a - t2->a;
    if(t1->b != t2->b) return t1->b - t2->b;
    return t1->c - t2->c;
}

struct cmpFunctor {
    inline bool operator() (const TS& t1, const TS& t2) {
        if(t1.a != t2.a) return t1.a < t2.a;
        if(t1.b != t2.b) return t1.b < t2.b;
        return t1.c <= t2.c;
    }
};

TS tss[N];

void genData() {
    _for(i, 0, N) {
        tss[i].a = rand();
        tss[i].b = rand();
        tss[i].c = rand();
    }
}

int main()
{
    srand(time(NULL));

    genData();
    clock_t start = clock();
    sort(tss, tss+N, cmp);
    printf("sort by funtion pointer : %ld\n", clock() - start);

    genData();
    start = clock();
    sort(tss, tss+N, cmpFunctor());
    printf("sort by functor : %ld\n", clock() - start);

    genData();
    start = clock();
    qsort(tss, N, sizeof(TS), cmp4qsort);
    printf("qsort by funtion pointer : %ld\n", clock() - start);

    return 0;
}
/*
    sort by function pointer : 36732
    sort by functor : 6324
    qsort by function 15996
*/

STL 的 sort 使用 functor 的版本是最快的，比 qsort 都快一倍多。
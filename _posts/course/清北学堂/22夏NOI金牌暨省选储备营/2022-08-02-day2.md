---
layout: post
title:  分治与分块
date:   2022-08-02
author: 吕秋实
categories: course qbxt 66
---

## 分治

## 最近点对问题

> [P1429 平面最近点对](https://www.luogu.com.cn/problem/P1429)

### Solution

* 将所有点按照 $x$ 坐标排序分治处理。
* 先处理出两边的点对的最小距离，假设其为 $d$。那么，我们接下来对每一个点只需要考虑另一边有没有与它距离小于 $d$ 的点。
* 可以证明这个范围内的点个数很少，于是只需要按照 $y$ 排序一下就可以找到这些点。
* 时间复杂度 $\mathcal O(n \log n)$。

## 例题 1

> 一个整数序列，给定若干询问，每个询问形如：在 $[l_i, r_i]$ 中选若干个长度为 $L$ 的不相交的区间，使得其和最大。
>
> $N \le 100000, Q \le 100000, L \le 50$

### Solution

* 考虑在分治的过程中计算所有过终点的询问的答案。假设当前的分治区间为 $[l, r]$，中点是 $mid$。然后我们先对每一个 $l'$，预处理出 $[l', mid]$ 这个区间选若干个长度为 $L$ 的区间，并在末尾选了 $x$ 个数（$x \le L$）的最大值，还有对于每一个 $r'$，处理出 $[mid + 1, r']$ 这个区间中选若干长度为 $L$ 的区间，并在开头选了 $x$ 个数（$x \le L$）的最大值，这个都可以用一个 $\text{DP}$ 求出。然后最后询问合并一下即可。
* 时间复杂度 $\mathcal O(n L \log n + q L)$。

## 例题 2

> [CF1100F Ivan and Burgers](https://www.luogu.com.cn/problem/CF1100F)

### Solution

* 考虑怎么去维护 $[l, r]$ 区间内的数的线性基。如果用线段树这样的数据结构去维护的话，复杂度是 $\mathcal O(q \log n \log^2 c)$ 的，显然不能通过本题。
* 考虑分治，还是考虑在分治过程中求出所有过中点的询问。然后考虑对于当前分治区间 $[l, r]$，求出 $[l, mid]$ 的每个后缀的线性基和 $[mid + 1, r]$ 的每个前缀的线性基，然后询问的时候合并一下即可。
* 时间复杂度 $\mathcal O(n \log n \log c + q \log^2 c)$。

## CDQ 分治

## 三维偏序问题

> [P3810 【模板】三维偏序（陌上花开）](https://www.luogu.com.cn/problem/P3810)

### Solution

* 考虑先将第一维排序，然后分治。考虑只有左边的点会对右边的点有贡献，故在分治过程中考虑左边的区间内的点对右边区间内的点的贡献。按照第二位进行归并排序，当加入了一个左边的点时，假设其第三维大小为 $x$，相当于要加入一个元素 $x$，当加入了一个右边的点时，假设其第三维大小为 $x$，相当于要求加入的 $\le x$ 的点有多少个，这个直接用树状数组维护即可。
* 时间复杂度 $\mathcal O(n \log^2 n)$.

## 例题 3

> 有 $n$ 个两两不相同的数 $a[i]$，现在你要选一些下标 $i_1, i_2, \cdots, i_k$，使得其 $a$ 值单调不递减。然后对于一段极长的长度为 $x$ 的空格，费用为 $(x + 1)^2$。求最小的费用。
>
> $n \le 500000$

### Solution

* 考虑朴素 $\text{DP}$，$\text{DP}$ 方程为：$dp_i = \min_{a_j \le a_i} dp_j + (i - j)^2 = \min_{a_j \le a_i} dp_j + j^2 - 2ij + i^2$。
* 考虑显然可以斜率优化，但是 $a_j \le a_i$ 的限制比较难处理，于是考虑将所有的下标按照 $a$ 值从小到大排序。然后分治考虑左边的下标转移到右边的下标，然后考虑按照下标大小归并排序，归并同时维护凸壳即可。
* 时间复杂度 $\mathcal O(n \log n)$

## 整体二分

## 例题 4

> [[AGC002D] Stamp Rally](https://www.luogu.com.cn/problem/AT_agc002_d)

### Solution

* 考虑整体二分，如果 $x$ 和 $y$ 所在的连通分量点数总合（如果 $x$ 和 $y$ 在一个连通分量里就算该连通分量的点数）$\ge z$，那么就合法。
* 在 $solve(l, r, ql, qr)$ 时，假设我们已经处理出了 $\le ql$ 的并查集，然后设 $mid = (ql + qr) / 2$，处理出 $\le mid$ 的并查集，判断一下合不合法，然后把答案 $\le mid$ 的和 $\gt mid$ 的放在一起，假设分界线是 $p$，递归执行 $solve(l, p, pl, mid)$ 和 $solve(p + 1, r, mid + 1, qr)$ 即可。

## 例题 5

> 有 $n$ 个位置，$m$ 个操作。操作有两种，每次操作如果是 $1~a~b~c$ 的形式表示在第 $a$ 个位置到第 $b$ 个位置，每个位置加入一个数 $c$。如果是 $2~a~b~c$ 的形式，表示询问从第 $a$ 个位置到第 $b$ 个位置，第 $c$ 大的数是多少。
>
> $n, m \le 10^5$

### Solution

* 考虑整体二分，先直接线段树求出每个询问应该取左边还是取右边，然后把关于左边的数字和询问放在一起，关于右边的数字和询问放在一起，递归处理下去即可。

## 例题 6

> [POJ1741 Tree](http://poj.org/problem?id=1741)

### Solution

* 点分治模版题，考虑合并两段路径的时候直接 $\text{two pointers}$ 扫一下即可。

## 例题 7

> [P4292 [WC2010]重建计划](https://www.luogu.com.cn/problem/P4292)

### Solution

